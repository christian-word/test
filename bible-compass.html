<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–ª–æ–≤–æ –Ω–∞ –∫–æ–∂–µ–Ω –¥–µ–Ω—å ‚Äî –ë—ñ–±–ª—ñ–π–Ω–∏–π –∫–æ–º–ø–∞—Å</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); min-height: 100vh; color: #333; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        .header { background: rgba(255,255,255,0.95); border-radius: 20px; padding: 20px; margin-bottom: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); text-align: center; }
        .header h1 { font-size: 2em; color: #1e3c72; }
        .header p { color: #666; }
        .controls { background: rgba(255,255,255,0.9); border-radius: 15px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .search-group, .ai-input { margin-bottom: 20px; }
        input { width: 100%; padding: 12px; border: 2px solid #e0e6ed; border-radius: 10px; font-size: 16px; }
        input:focus { outline: none; border-color: #2a5298; box-shadow: 0 0 0 3px rgba(42,82,152,0.1); }
        .categories { display: flex; flex-wrap: wrap; gap: 10px; margin: 20px 0; }
        .category-btn { padding: 8px 12px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .category-btn:hover { background: #45a049; }
        .btn { padding: 12px 24px; background: linear-gradient(135deg, #1e3c72, #2a5298); color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 16px; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .verse { background: rgba(255,255,255,0.95); margin-bottom: 15px; padding: 15px; border-left: 4px solid #2a5298; border-radius: 8px; }
        .verse-number { font-weight: bold; color: #1e3c72; margin-right: 10px; }
        .verse-text { line-height: 1.6; font-size: 1.1em; }
        .actions { display: flex; gap: 5px; margin-top: 10px; }
        .action-btn { background: none; border: none; font-size: 18px; cursor: pointer; }
        .action-btn.active { color: gold; }
        .favorites, .bookmarks-panel { margin-top: 20px; background: rgba(255,255,255,0.9); border-radius: 10px; padding: 10px; }
        .bookmark-item { padding: 5px 10px; cursor: pointer; border-radius: 5px; }
        .bookmark-item:hover { background: rgba(30,60,114,0.1); }
        #ai-result { background: #e3f2fd; padding: 15px; border-radius: 5px; margin-top: 10px; }
        canvas { max-width: 100%; margin-top: 10px; }
        @media (max-width: 768px) { .categories { flex-direction: column; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìñ –°–ª–æ–≤–æ –Ω–∞ –∫–æ–∂–µ–Ω –¥–µ–Ω—å</h1>
            <p>–ë—ñ–±–ª—ñ–π–Ω–∏–π –∫–æ–º–ø–∞—Å –¥–ª—è –∂–∏—Ç—Ç—è</p>
        </div>
        <div class="controls">
            <div class="search-group">
                <input type="text" id="searchInput" placeholder="üîç –ü–æ—à—É–∫ –∑–∞ –∫–ª—é—á–æ–≤–∏–º–∏ —Å–ª–æ–≤–∞–º–∏...">
                <button class="btn" onclick="searchVerses()">–ó–Ω–∞–π—Ç–∏</button>
                <button class="btn" onclick="clearSearch()">–û—á–∏—Å—Ç–∏—Ç–∏</button>
            </div>
            <div class="ai-input">
                <input type="text" id="aiQuery" placeholder="ü§ñ –û–ø–∏—à—ñ—Ç—å —Å–∏—Ç—É–∞—Ü—ñ—é (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, '–ú–µ–Ω—ñ —Å—Ç—Ä–∞—à–Ω–æ –ø–µ—Ä–µ–¥ —ñ—Å–ø–∏—Ç–æ–º')">
                <button class="btn" onclick="aiSuggest()">–ü—ñ–¥—ñ–±—Ä–∞—Ç–∏ –≤—ñ—Ä—à</button>
                <div id="ai-result"></div>
            </div>
        </div>
        <div class="categories">
            <h3>üìö –ö–∞—Ç–µ–≥–æ—Ä—ñ—ó</h3>
            <button class="category-btn" onclick="loadCategory('strength')">üí™ –°–∏–ª–∞</button>
            <button class="category-btn" onclick="loadCategory('comfort')">üòå –í—Ç—ñ—Ö–∞</button>
            <button class="category-btn" onclick="loadCategory('love')">‚ù§Ô∏è –õ—é–±–æ–≤</button>
            <button class="category-btn" onclick="loadCategory('faith')">üôè –í—ñ—Ä–∞</button>
            <button class="category-btn" onclick="loadCategory('hope')">üåü –ù–∞–¥—ñ—è</button>
            <button class="category-btn" onclick="loadCategory('wisdom')">üí° –ú—É–¥—Ä—ñ—Å—Ç—å</button>
        </div>
        <div class="bookmarks-panel">
            <strong>‚≠ê –ó–∞–∫–ª–∞–¥–∫–∏:</strong>
            <div id="bookmarksList"></div>
        </div>
        <div id="verseOfDay">
            <h3>üåü –í—ñ—Ä—à –¥–Ω—è</h3>
            <div id="dailyVerse"></div>
        </div>
        <div id="versesList"></div>
    </div>

    <script>
        // –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–π API –¥–ª—è –ë–∏–±–ª–∏–∏
        class MyBibleAPI {
            constructor(jsonUrl) {
                this.jsonUrl = jsonUrl || 'https://raw.githubusercontent.com/christian-word/test/refs/heads/main/bible_ua.json';
                this._loaded = false;
                this._books = [];
                this._ready = this._load();
            }

            async ready() {
                return this._ready;
            }

            async _load() {
                try {
                    const res = await fetch(this.jsonUrl);
                    if (!res.ok) throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ JSON: ${res.status} ${res.statusText}`);
                    const raw = await res.json();
                    this._normalize(raw);
                    this._loaded = true;
                    console.info('MyBibleAPI: JSON –∑–∞–≥—Ä—É–∂–µ–Ω –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω.');
                } catch (err) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ MyBibleAPI:', err);
                    throw err;
                }
            }

            _normalize(raw) {
                let booksRaw = Array.isArray(raw) ? raw : (raw.books || raw.body || []);
                this._books = booksRaw.map((b, bi) => {
                    const number = String(b.number || bi + 1);
                    const shortName = b.shortName || b.abbr || '';
                    const name = b.name || `–ö–Ω–∏–≥–∞ ${number}`;
                    const chapters = (Array.isArray(b.chapters) ? b.chapters : []).map((ch, ci) => {
                        const chNumber = String(ch.number || ci + 1);
                        const verses = (Array.isArray(ch.verses) ? ch.verses : []).map((v, vi) => {
                            const vNumber = String(v.number || vi + 1);
                            const text = String(v.text || '');
                            return { number: vNumber, text, textLower: text.toLowerCase() };
                        });
                        return { number: chNumber, verses };
                    });
                    return { number, shortName, name, chapters };
                });
            }

            _findBook(identifier) {
                if (!identifier) return null;
                const s = String(identifier).toLowerCase();
                return this._books.find(b => b.number === s || b.name.toLowerCase() === s || b.shortName.toLowerCase() === s) ||
                       this._books.find(b => b.name.toLowerCase().includes(s) || b.shortName.toLowerCase().includes(s)) || null;
            }

            async getBooks() {
                if (!this._loaded) await this._ready;
                return this._books.map(b => ({ number: b.number, shortName: b.shortName, name: b.name }));
            }

            async getChapters(bookId) {
                if (!this._loaded) await this._ready;
                const book = this._findBook(bookId);
                return book ? book.chapters.map(ch => ch.number) : [];
            }

            async getVerses(bookId, chapterId) {
                if (!this._loaded) await this._ready;
                const book = this._findBook(bookId);
                if (!book) return [];
                const chapter = book.chapters.find(ch => ch.number === String(chapterId)) || null;
                return chapter ? chapter.verses.map(v => ({ number: v.number, text: v.text })) : [];
            }

            async getVerse(bookId, chapterId, verseId) {
                const verses = await this.getVerses(bookId, chapterId);
                return verses.find(v => v.number === String(verseId)) || null;
            }

            async getVersesRange(bookId, chapterId, rangeStr) {
                const verses = await this.getVerses(bookId, chapterId);
                const parts = String(rangeStr).split(',').map(p => p.trim());
                const nums = new Set();
                parts.forEach(p => {
                    if (p.includes('-')) {
                        const [start, end] = p.split('-').map(Number);
                        for (let i = start; i <= end; i++) nums.add(i);
                    } else {
                        nums.add(Number(p));
                    }
                });
                return Array.from(nums).sort((a, b) => a - b).map(n => verses.find(v => Number(v.number) === n)).filter(Boolean);
            }

            async search(query) {
                if (!this._loaded) await this._ready;
                const q = String(query).toLowerCase();
                const results = [];
                this._books.forEach(book => {
                    book.chapters.forEach(ch => {
                        ch.verses.forEach(v => {
                            if (v.textLower.includes(q)) {
                                results.push({ book: book.name, chapter: ch.number, verse: v.number, text: v.text });
                            }
                        });
                    });
                });
                return results;
            }

            async searchRegex(pattern) {
                if (!this._loaded) await this._ready;
                let regex;
                try {
                    regex = new RegExp(pattern, 'giu');
                } catch (e) {
                    console.error('–ù–µ–≤–µ—Ä–Ω—ã–π regex:', e);
                    return [];
                }
                const results = [];
                this._books.forEach(book => {
                    book.chapters.forEach(ch => {
                        ch.verses.forEach(v => {
                            regex.lastIndex = 0;
                            if (regex.test(v.text)) {
                                results.push({ book: book.name, chapter: ch.number, verse: v.number, text: v.text });
                            }
                        });
                    });
                });
                return results;
            }

            async getRandomVerse() {
                if (!this._loaded) await this._ready;
                const book = this._books[Math.floor(Math.random() * this._books.length)];
                const ch = book.chapters[Math.floor(Math.random() * book.chapters.length)];
                const v = ch.verses[Math.floor(Math.random() * ch.verses.length)];
                return { book: book.name, chapter: ch.number, verse: v.number, text: v.text };
            }
        }

        const bible = new MyBibleAPI();

        // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
        const categories = {
            strength: [
                { book: "–§–∏–ª–∏–ø‚Äô—è–Ω", chapter: "4", verse: "13", text: "–Ø –≤—Å–µ –º–æ–∂—É –≤ –¢—ñ–º, –•—Ç–æ –º–µ–Ω–µ –∑–º—ñ—Ü–Ω—é—î, ‚Äî –≤ –•—Ä–∏—Å—Ç—ñ." }
            ],
            comfort: [
                { book: "–ü—Å–∞–ª–º–∏", chapter: "23", verse: "4", text: "–ö–æ–ª–∏ —è –ø—ñ–¥—É –Ω–∞–≤—ñ—Ç—å –¥–æ–ª–∏–Ω–æ—é —Å–º–µ—Ä—Ç–Ω–æ—ó —Ç—ñ–Ω—ñ, —Ç–æ –Ω–µ –±—É–¥—É –±–æ—è—Ç–∏—Å—è –∑–ª–∞, –±–æ –¢–∏ –∑—ñ –º–Ω–æ—é." }
            ],
            love: [
                { book: "–Ü–≤–∞–Ω–∞", chapter: "3", verse: "16", text: "–¢–∞–∫ –±–æ –ë–æ–≥ –ø–æ–ª—é–±–∏–≤ —Å–≤—ñ—Ç, —â–æ –¥–∞–≤ –°–∏–Ω–∞ –°–≤–æ–≥–æ –û–¥–Ω–æ—Ä–æ–¥–∂–µ–Ω–æ–≥–æ..." }
            ],
            faith: [
                { book: "–Ñ–≤—Ä–µ—ó–≤", chapter: "11", verse: "1", text: "–ê –≤—ñ—Ä–∞ ‚Äî —Ç–æ –ø—ñ–¥—Å—Ç–∞–≤–∞ —Å–ø–æ–¥—ñ–≤–∞–Ω–æ–≥–æ, –¥–æ–∫–∞–∑ –Ω–µ–±–∞—á–µ–Ω–æ–≥–æ." }
            ],
            hope: [
                { book: "–†–∏–º–ª—è–Ω", chapter: "15", verse: "13", text: "–ë–æ–≥ –∂–µ –Ω–∞–¥—ñ—ó –Ω–µ—Ö–∞–π —Å–ø–æ–≤–Ω–∏—Ç—å –≤–∞—Å —É—Å—è–∫–æ—é —Ä–∞–¥—ñ—Å—Ç—é –π –º–∏—Ä–æ–º —É –≤—ñ—Ä—ñ..." }
            ],
            wisdom: [
                { book: "–ü—Ä–∏–ø–æ–≤—ñ—Å—Ç—ñ", chapter: "3", verse: "5", text: "–ù–∞–¥—ñ–π—Å—è –Ω–∞ –ì–æ—Å–ø–æ–¥–∞ –≤—Å—ñ–º —Å–≤–æ—ó–º —Å–µ—Ä—Ü–µ–º, –∞ –Ω–∞ —Ä–æ–∑—É–º —Å–≤—ñ–π –Ω–µ –ø–æ–∫–ª–∞–¥–∞–π—Å—è." }
            ]
        };

        // –°–ª–æ–≤–∞—Ä—å —Å–∏–Ω–æ–Ω–∏–º–æ–≤ –¥–ª—è –ò–ò
        const synonyms = {
            —Å—Ç—Ä–∞—Ö: ['—Ç—Ä–∏–≤–æ–≥–∞', '–±–æ—è–∑–Ω—å', '–Ω–µ—Ä–≤–∏', '—ñ—Å–ø–∏—Ç'],
            –≤—Ç—ñ—Ö–∞: ['—Å—É–º', '—Å–∞–º–æ—Ç–Ω—ñ—Å—Ç—å', '–ø–µ—á–∞–ª—å', '–≥–æ—Ä–µ'],
            –ª—é–±–æ–≤: ['–ø—Ä–æ—â–µ–Ω–Ω—è', '–¥–æ–±—Ä–æ—Ç–∞', '–º–∏–ª–æ—Å–µ—Ä–¥—è'],
            –≤—ñ—Ä–∞: ['–¥–æ–≤—ñ—Ä–∞', '–Ω–∞–¥—ñ—è', '–º–æ–ª–∏—Ç–≤–∞'],
            –Ω–∞–¥—ñ—è: ['—Å–ø–æ–¥—ñ–≤–∞–Ω–Ω—è', '–º–∞–π–±—É—Ç–Ω—î'],
            –º—É–¥—Ä—ñ—Å—Ç—å: ['—Ä–æ–∑—É–º', '–∑–Ω–∞–Ω–Ω—è', '–ø–æ—Ä–∞–¥–∞']
        };

        // –°–≤—è–∑–∞–Ω–Ω—ã–µ —Å—Ç–∏—Ö–∏
        const relatedVerses = {
            '–Ü–≤–∞–Ω–∞ 3:16': ['–ï—Ñ–µ—Å—è–Ω 2:8-9', '–†–∏–º–ª—è–Ω 10:9'],
            '–ï—Ñ–µ—Å—è–Ω 2:8-9': ['–†–∏–º–ª—è–Ω 5:1'],
            '–§–∏–ª–∏–ø‚Äô—è–Ω 4:13': ['–Ü—Å–∞—ó 41:10']
        };

        // –ë–∏–±–ª–µ–π—Å–∫–∞—è –∞–ø—Ç–µ—á–∫–∞
        const firstAid = {
            —Å—Ç—Ä–∞—Ö: {
                verse: categories.strength[0],
                prayer: '–ì–æ—Å–ø–æ–¥–∏, –¥–∞–π –º–µ–Ω—ñ —Å–∏–ª—É —ñ –º–∏—Ä –ø–µ—Ä–µ–¥ –≤–∏–ø—Ä–æ–±—É–≤–∞–Ω–Ω—è–º–∏.',
                advice: '–ü—Ä–æ—á–∏—Ç–∞–π —Ü–µ–π –≤—ñ—Ä—à –ø–µ—Ä–µ–¥ —Å–Ω–æ–º —ñ –ø–æ–º–æ–ª–∏—Å—å –∑–∞ —Å–ø–æ–∫—ñ–π.'
            },
            —Å–∞–º–æ—Ç–Ω—ñ—Å—Ç—å: {
                verse: categories.comfort[0],
                prayer: '–ì–æ—Å–ø–æ–¥–∏, –±—É–¥—å –∑—ñ –º–Ω–æ—é –≤ –º–æ—ó–π —Å–∞–º–æ—Ç–Ω–æ—Å—Ç—ñ.',
                advice: '–ü—Ä–æ—á–∏—Ç–∞–π —Ü–µ–π –≤—ñ—Ä—à —ñ –ø–æ–¥—É–º–∞–π –ø—Ä–æ –ë–æ–∂—É –ø—Ä–∏—Å—É—Ç–Ω—ñ—Å—Ç—å.'
            },
            —Ö–≤–æ—Ä–æ–±–∞: {
                verse: { book: "–ü—Å–∞–ª–º–∏", chapter: "30", verse: "3", text: "–ì–æ—Å–ø–æ–¥–∏, –ë–æ–∂–µ –º—ñ–π, —è –≤–∑–∏–≤–∞–≤ –¥–æ –¢–µ–±–µ, —ñ –¢–∏ –º–µ–Ω–µ –∑—Ü—ñ–ª–∏–≤." },
                prayer: '–ì–æ—Å–ø–æ–¥–∏, –¥–∞—Ä—É–π –º–µ–Ω—ñ –∑—Ü—ñ–ª–µ–Ω–Ω—è —ñ —Å–∏–ª—É.',
                advice: '–ú–æ–ª–∏—Å—å —Ü–∏–º –≤—ñ—Ä—à–µ–º —â–æ–¥–Ω—è –∑–∞ –∑–¥–æ—Ä–æ–≤‚Äô—è.'
            }
        };

        let bookmarks = JSON.parse(localStorage.getItem('bibleBookmarks') || '[]');

        async function init() {
            try {
                await bible.ready();
                renderBookmarks();
                loadDailyVerse();
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', e);
                document.getElementById('versesList').innerHTML = '<p style="color: red;">–ü–æ–º–∏–ª–∫–∞: –ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ë—ñ–±–ª—ñ—é. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å.</p>';
            }
        }

        function renderBookmarks() {
            const list = document.getElementById('bookmarksList');
            if (bookmarks.length === 0) {
                list.innerHTML = '<em>–ù–µ–º–∞—î –∑–∞–∫–ª–∞–¥–æ–∫</em>';
                return;
            }
            list.innerHTML = bookmarks.map(b => `
                <div class="bookmark-item">
                    <span onclick="displayVerse('${b.book}', '${b.chapter}', '${b.verse}')">${b.book} ${b.chapter}:${b.verse} ‚Äî ${b.text.slice(0, 40)}...</span>
                    <button class="action-btn" onclick="removeBookmark('${b.id}')">‚ùå</button>
                </div>
            `).join('');
        }

        async function toggleBookmark(book, chapter, verse, text) {
            const id = `${book}-${chapter}-${verse}`;
            const idx = bookmarks.findIndex(b => b.id === id);
            if (idx >= 0) {
                bookmarks.splice(idx, 1);
            } else {
                bookmarks.push({ id, book, chapter, verse, text });
            }
            localStorage.setItem('bibleBookmarks', JSON.stringify(bookmarks));
            renderBookmarks();
            const verses = await bible.getVerses(book, chapter);
            displayVerses(verses.map(v => ({ book, chapter, verse: v.number, text: v.text })));
        }

        function removeBookmark(id) {
            bookmarks = bookmarks.filter(b => b.id !== id);
            localStorage.setItem('bibleBookmarks', JSON.stringify(bookmarks));
            renderBookmarks();
        }

        async function searchVerses() {
            const query = document.getElementById('searchInput').value;
            if (!query) return;
            const results = await bible.search(query);
            displayVerses(results);
        }

        function clearSearch() {
            document.getElementById('searchInput').value = '';
            document.getElementById('versesList').innerHTML = '';
        }

        async function loadCategory(category) {
            const verses = categories[category] || [];
            displayVerses(verses);
        }

        async function loadDailyVerse() {
            const verse = await bible.getRandomVerse();
            if (verse) {
                document.getElementById('dailyVerse').innerHTML = `
                    <div class="verse">
                        <span class="verse-number">${verse.book} ${verse.chapter}:${verse.verse}</span>
                        <span class="verse-text">${verse.text}</span>
                    </div>
                `;
            }
        }

        async function aiSuggest() {
            const query = document.getElementById('aiQuery').value.toLowerCase();
            if (!query) return;

            let category = 'faith';
            let firstAidKey = null;
            for (const [cat, words] of Object.entries(synonyms)) {
                if (words.some(word => query.includes(word))) {
                    category = cat;
                    break;
                }
            }
            for (const [key, item] of Object.entries(firstAid)) {
                if (query.includes(key) || synonyms[category]?.some(word => query.includes(word))) {
                    firstAidKey = key;
                    break;
                }
            }

            const verses = categories[category] || [];
            const verse = firstAidKey ? firstAid[firstAidKey].verse : (verses[0] || await bible.getRandomVerse());
            const ref = `${verse.book} ${verse.chapter}:${verse.verse}`;
            const explanations = {
                strength: '–¶–µ–π –≤—ñ—Ä—à –Ω–∞–¥–∏—Ö–∞—î –Ω–∞ —Å—Ç—ñ–π–∫—ñ—Å—Ç—å —ñ –¥–æ–≤—ñ—Ä—É –¥–æ –ë–æ–∂–æ—ó —Å–∏–ª–∏.',
                comfort: '–¶–µ–π –≤—ñ—Ä—à –ø—Ä–∏–Ω–æ—Å–∏—Ç—å –º–∏—Ä —ñ –≤—Ç—ñ—Ö—É –≤ —Å–∫—Ä—É—Ç–Ω—ñ —á–∞—Å–∏.',
                love: '–¶–µ–π –≤—ñ—Ä—à –Ω–∞–≥–∞–¥—É—î –ø—Ä–æ –ë–æ–∂—É –ª—é–±–æ–≤ —ñ –º–∏–ª–æ—Å–µ—Ä–¥—è.',
                faith: '–¶–µ–π –≤—ñ—Ä—à –∑–º—ñ—Ü–Ω—é—î –≤—ñ—Ä—É –≤ –ë–æ–≥–∞.',
                hope: '–¶–µ–π –≤—ñ—Ä—à –¥–∞—î –Ω–∞–¥—ñ—é –Ω–∞ –∫—Ä–∞—â–µ –º–∞–π–±—É—Ç–Ω—î.',
                wisdom: '–¶–µ–π –≤—ñ—Ä—à –≤—á–∏—Ç—å –ø–æ–∫–ª–∞–¥–∞—Ç–∏—Å—è –Ω–∞ –ë–æ–∂—É –º—É–¥—Ä—ñ—Å—Ç—å.'
            };
            const explanation = firstAidKey
                ? `–î–ª—è "${query}" –ø—ñ–¥—Ö–æ–¥–∏—Ç—å: "${verse.text}". ${firstAid[firstAidKey].advice} –ú–æ–ª–∏—Ç–≤–∞: ${firstAid[firstAidKey].prayer}`
                : `–î–ª—è "${query}" –ø—ñ–¥—Ö–æ–¥–∏—Ç—å: "${verse.text}". ${explanations[category] || '–ü—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è –≤–∞—à–æ—ó —Å–∏—Ç—É–∞—Ü—ñ—ó.'}`;
            const related = relatedVerses[ref] ? `–ü–æ–≤‚Äô—è–∑–∞–Ω—ñ –≤—ñ—Ä—à—ñ: ${relatedVerses[ref].join(', ')}.` : '';
            document.getElementById('ai-result').innerHTML = `<strong>${ref}</strong><p>${verse.text}</p><p>${explanation} ${related}</p>`;
        }

        function displayVerses(verses) {
            const list = document.getElementById('versesList');
            list.innerHTML = verses.map(v => {
                const id = `${v.book}-${v.chapter}-${v.verse}`;
                const active = bookmarks.some(b => b.id === id);
                return `
                    <div class="verse">
                        <span class="verse-number">${v.book} ${v.chapter}:${v.verse}</span>
                        <span class="verse-text">${v.text}</span>
                        <div class="actions">
                            <button class="action-btn ${active ? 'active' : ''}" onclick="toggleBookmark('${v.book}', '${v.chapter}', '${v.verse}', \`${v.text.replace(/`/g, '\\`')}\`)">${active ? '‚òÖ' : '‚òÜ'}</button>
                            <button class="action-btn" onclick="addNote('${id}')">‚úèÔ∏è</button>
                            <button class="action-btn" onclick="createImage('${v.text}', '${v.book} ${v.chapter}:${v.verse}')">üé®</button>
                            <button class="action-btn" onclick="exportVerse('${v.book} ${v.chapter}:${v.verse}', '${v.text}')">üì§</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        async function displayVerse(book, chapter, verse) {
            const v = await bible.getVerse(book, chapter, verse);
            if (v) {
                displayVerses([{ book, chapter, verse: v.number, text: v.text }]);
            }
        }

        function addNote(id) {
            const note = prompt('–î–æ–¥–∞–π—Ç–µ –Ω–æ—Ç–∞—Ç–∫—É:');
            if (note) {
                let notes = JSON.parse(localStorage.getItem('notes') || '{}');
                notes[id] = note;
                localStorage.setItem('notes', JSON.stringify(notes));
                alert('–ù–æ—Ç–∞—Ç–∫—É –∑–±–µ—Ä–µ–∂–µ–Ω–æ!');
            }
        }

        function createImage(text, ref) {
            const canvas = document.createElement('canvas');
            canvas.width = 400; canvas.height = 200;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#4CAF50'; ctx.fillRect(0, 0, 400, 200);
            ctx.fillStyle = 'white'; ctx.font = '20px Arial';
            ctx.fillText(ref, 20, 30);
            ctx.font = '16px Arial';
            ctx.fillText(text.slice(0, 100), 20, 60, 360);
            const link = document.createElement('a');
            link.download = `${ref.replace(/ /g, '_')}.png`;
            link.href = canvas.toDataURL();
            link.click();
        }

        function exportVerse(ref, text) {
            const blob = new Blob([`${ref}: ${text}`], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = `${ref.replace(/ /g, '_')}.txt`; a.click();
        }

        init();
    </script>
</body>
</html>