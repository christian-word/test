<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>Тест ІІ Путеводителя по Біблії (v2.0)</title>
<style>
  body { 
    font-family: Arial, sans-serif; 
    background: #1a1a2e; 
    color: #eaeaea; 
    margin: 0; 
    padding: 0; 
  }
  header { 
    padding: 1rem; 
    text-align: center; 
    background: #162447; 
  }
  main { 
    padding: 1rem; 
    max-width: 800px; 
    margin: auto; 
  }
  input, select, button { 
    padding: 0.75rem; /* Збільшено для кращого вигляду */
    margin: 0.5rem 0; 
    width: 100%; 
    border: 1px solid #0f3460;
    border-radius: 4px;
    box-sizing: border-box; /* Важливо для width: 100% */
  }
  button {
    background: #ffd369;
    color: #1a1a2e;
    cursor: pointer;
    font-weight: bold;
    transition: background 0.3s;
  }
  button:hover {
    background: #ffc433;
  }
  .results { 
    margin-top: 1.5rem; /* Збільшено відступ */
    background: #0f3460; 
    padding: 1.5rem; 
    border-radius: 8px; 
    min-height: 100px; /* Мінімальна висота для кращого вигляду */
    white-space: pre-wrap; /* Зберігає переноси рядків */
  }
  .error {
    color: #ff6b6b;
    font-weight: bold;
  }
  .success {
    color: #6bff95;
    font-weight: bold;
  }
  .local {
    color: #ffd369;
  }
</style>
</head>
<body>
<header>
  <h1>📖 Тест ІІ Путеводителя по Біблії</h1>
</header>
<main>
  <h2>Налаштування API</h2>
  <p>🚨 **УВАГА:** Для роботи потрібен дійсний Hugging Face Access Token. Запустіть цей код на веб-сервері (наприклад, Live Server), щоб уникнути помилок **CORS**.</p>
  
  <input type="text" id="apiToken" placeholder="Введіть ваш HF Access Token тут..." value="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">

  <h2>Запит</h2>
  <input type="text" id="query" placeholder="Введіть слово або тему (наприклад, 'Молитва')..." value="Молитва">
  <select id="mode">
    <option value="dictionary">📚 Словник</option>
    <option value="context">📖 Контекст</option>
    <option value="parallel">📖 Паралел</option>
  </select>
  <button onclick="search()">🔍 Пошук</button>

  <h2>Результати</h2>
  <div class="results" id="results">
    Очікування запиту...
  </div>
</main>

<script>
// Локальний словник і паралелі
const localData = {
  dictionary: {
    "віра": "<span class='local'>Віра</span> – це довіра і впевненість у Бозі (Євр. 11:1).",
    "милосердя": "<span class='local'>Милосердя</span> – це прояв любові до ближнього (Мф. 5:7)."
  },
  context: {
    "мойсей": "<span class='local'>Мойсей</span> – провідник Ізраїля, прийняв Закон на горі Синай (Исх. 3-20)."
  },
  parallel: {
    "любов": `<span class='local'>Паралелі до любові:</span> <a href='#1Кор13'>1 Кор. 13</a>, <a href='#Ів15'>Ів. 15:12-13</a>, <a href='#Рим5'>Рим. 5:8</a>`
  }
};

/**
 * Основна функція пошуку, що перевіряє локальні дані
 * та викликає Hugging Face API
 */
async function search() {
  const query = document.getElementById('query').value.trim().toLowerCase();
  const mode = document.getElementById('mode').value;
  const apiToken = document.getElementById('apiToken').value.trim();
  const resultsDiv = document.getElementById('results');
  resultsDiv.innerHTML = '⏳ **Завантаження...** Перевіряємо локальні дані та викликаємо API...';

  if (!query) {
    resultsDiv.innerHTML = '<span class="error">❌ Введіть запит для пошуку!</span>';
    return;
  }
  
  if (!apiToken || apiToken === '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') {
      resultsDiv.innerHTML = '<span class="error">❌ **Помилка токена:** Будь ласка, введіть дійсний Hugging Face Access Token.</span>';
      return;
  }

  // 1. Локальний пошук (якщо є)
  const localResult = localData[mode][query];
  if (localResult) {
    resultsDiv.innerHTML = `**✅ Локальний результат (${mode}):**<hr>${localResult}<hr>Продовжуємо пошук через ІІ для порівняння...<br>`;
    // Можна додати return, щоб зупинитись, але для тестування викликаємо API
  } else {
    resultsDiv.innerHTML = '⏳ **Локальних даних не знайдено.** Викликаємо Hugging Face API...';
  }

  // 2. Hugging Face API запит
  const API_URL = 'https://api-inference.huggingface.co/models/bigscience/bloom-560m';
  
  // Динамічний промпт
  const prompt = `Твоя задача: зробити біблійний ${mode === 'dictionary' ? 'словник' : mode === 'context' ? 'контекст' : 'паралель'} по запиту: "${query}". Дай коротку, зрозумілу відповідь українською.`;
  
  try {
    const response = await fetch(API_URL, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${apiToken}`, // Використовуємо токен з поля
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ 
        inputs: prompt, 
        parameters: { 
            max_new_tokens: 150, // Обмеження для швидкості
            temperature: 0.7,    // Додавання креативності
        } 
      })
    });

    // Перевірка HTTP помилок (401, 404, 500 тощо)
    if (!response.ok) {
        const errorData = await response.json();
        const errorMessage = errorData.error || response.statusText;
        resultsDiv.innerHTML = (localResult ? resultsDiv.innerHTML + '<br><br>' : '') + 
                               `<span class="error">❌ **Помилка API (HTTP ${response.status}):** ${errorMessage}</span><br>
                               <small><i>Це може бути недійсний токен, помилка моделі або проблема CORS.</i></small>`;
        return;
    }
    
    // Успішна відповідь
    const data = await response.json();

    if (data && data[0] && data[0].generated_text) {
        let aiText = data[0].generated_text;
        
        // Видалення вхідного промпта, який часто повторюється у відповіді
        if (aiText.startsWith(prompt)) {
            aiText = aiText.substring(prompt.length).trim();
        }

        const finalResult = (localResult ? resultsDiv.innerHTML + '<br>' : '') +
                            `<span class="success">✅ **Результат Hugging Face AI:**</span><hr>${aiText}`;

        resultsDiv.innerHTML = finalResult;

    } else {
        resultsDiv.innerHTML = (localResult ? resultsDiv.innerHTML + '<br><br>' : '') + 
                               `<span class="error">❌ **Помилка: Неочікуваний формат відповіді від API.**</span>`;
    }

  } catch (err) {
    // Помилки мережі або Fetch (наприклад, CORS)
    resultsDiv.innerHTML = (localResult ? resultsDiv.innerHTML + '<br><br>' : '') +
                           `<span class="error">❌ **Помилка мережі (CORS?):** ${err.message}</span><br>
                           <small><i>Спробуйте запустити код на веб-сервері.</i></small>`;
  }
}
</script>
</body>
</html>